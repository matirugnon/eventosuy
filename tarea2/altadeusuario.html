<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Alta de usuario · eventos.uy</title>
  <link rel="stylesheet" href="styles.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap"
    rel="stylesheet" />
</head>

<body>
  <div>
    <main class="single">
      <section class="register-section">
        <div class="register-container">
          <h2>Registrarse</h2>
          <form id="formAlta" class="auth-form" autocomplete="on" novalidate>
            <div class="input-group">
              <span class="label-text">Rol</span>
              <div style="display:flex; gap:1rem;">
                <label class="row"><input type="radio" name="rol" value="asistente" checked> Asistente</label>
                <label class="row"><input type="radio" name="rol" value="organizador"> Organizador</label>
              </div>
            </div>

            <label class="input-group">
              <span class="label-text">Nickname *</span>
              <input name="nickname" required maxlength="30" placeholder="nick_name" />
            </label>

            <label class="input-group">
              <span class="label-text">Nombre *</span>
              <input name="nombre" required maxlength="60" placeholder="Nombre" />
            </label>

            <label class="input-group">
              <span class="label-text">Correo electrónico *</span>
              <input name="email" type="email" required placeholder="name@example.com" />
            </label>

            <div class="grid-2">
              <label class="input-group">
                <span class="label-text">Contraseña *</span>
                <input name="password" type="password" required minlength="6" autocomplete="new-password" />
              </label>
              <label class="input-group">
                <span class="label-text">Confirmar contraseña *</span>
                <input name="confirm" type="password" required minlength="6" autocomplete="new-password" />
              </label>
            </div>

            <label class="input-group">
              <span class="label-text">Imagen (opcional)</span>
              <input name="imagen" type="file" accept="image/*" />
            </label>


            <!--                Específico Asistente                 -->
            <div id="bloqueAsistente" style="margin-top:1rem;">
              <h3 style="color:#182080; font-size:1rem;">Datos de asistente</h3>
              <div style="display:grid; grid-template-columns:1fr 1fr; gap:.75rem; margin-top:.5rem;">
                <label class="input-group">
                  <span class="label-text">Apellido *</span>
                  <input name="apellido" maxlength="60" placeholder="Apellido" />
                </label>
                <label class="input-group">
                  <span class="label-text">Fecha de nacimiento *</span>
                  <input name="fechaNacimiento" type="date" />
                </label>
              </div>
              <label class="input-group">
                <input type="checkbox" id="chkInstitucion" />
                <span style="margin-left:.35rem;">Pertenezco a una institución</span>
              </label>
              <div id="bloqueInstitucion" style="display:none; margin-top:.5rem;">
                <label class="input-group">
                  <span class="label-text">Institución</span>
                  <!-- Parte 1: lista hardcodeada -->
                  <select name="institucion">
                    <option value="">Seleccionar…</option>
                    <option value="Udelar">Udelar</option>
                    <option value="ORT">Universidad ORT</option>
                    <option value="UM">Universidad de Montevideo</option>
                  </select>
                </label>
              </div>
            </div>
            <!--                   Específico Organizador                 -->
            <div id="bloqueOrganizador" style="display:none; margin-top:1rem;">
              <h3 style="color:#182080; font-size:1rem;">Datos de organizador</h3>
              <label class="input-group" style="margin-top:.5rem;">
                <span class="label-text">Descripción (opcional)</span>
                <textarea name="descripcion" rows="3" maxlength="500"
                  placeholder="Somos una organización de…"></textarea>
              </label>
              <label class="input-group">
                <span class="label-text">Sitio web (opcional)</span>
                <input name="web" type="url" placeholder="https://mi-sitio.org" />
              </label>
            </div>

            <div id="msg" style="color:#c00; margin-top:.4rem; min-height:1.25rem;"></div>

            <button type="submit" class="btn-primary" style="margin-top:1rem; width:100%;">Crear cuenta</button>
            <div style="text-align:center; margin-top:1.5rem;">
              <a class="btn-outline" href="index.html">Cancelar</a>
            </div>
          </form>
        </div>
      </section>
    </main>
  </div>

  <footer></footer>
  <style>
    .register-section {
      width: 100%;
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      width: 100%;
      padding: 50px;
    }

    .register-container {
      border: 1px solid #182080;
      border-radius: 8px;
      padding: 20px;
      background-color: rgb(233, 233, 233);
    }

    form {
      display:flex;
      flex-direction: column;
      gap: 1rem;
    }

    .input-group {
      display: flex;
      flex-direction: column;
    }
  </style>
  <script>
    (function () {
      const $ = s => document.querySelector(s);
      const $$ = s => document.querySelectorAll(s);

      const form = $('#formAlta');
      const rolRadios = $$('input[name="rol"]');
      const bloqueAs = $('#bloqueAsistente');
      const bloqueOr = $('#bloqueOrganizador');
      const chkInst = $('#chkInstitucion');
      const bloqueInst = $('#bloqueInstitucion');
      const inputImg = form.elements['imagen'];
      const preview = $('#preview');
      const previewImg = $('#previewImg');
      const msg = $('#msg');


      function toggleRol() {
        const rol = [...rolRadios].find(r => r.checked)?.value;
        const esAs = rol === 'asistente';
        bloqueAs.style.display = esAs ? '' : 'none';
        bloqueOr.style.display = esAs ? 'none' : '';
        // requeridos según rol
        form.elements['apellido'].required = esAs;
        form.elements['fechaNacimiento'].required = esAs;
      }

      function toggleInstitucion() {
        bloqueInst.style.display = chkInst.checked ? '' : 'none';
      }

      function showPreview(file) {
        if (!file) { preview.style.display = 'none'; previewImg.src = ''; return; }
        const reader = new FileReader();
        reader.onload = () => { previewImg.src = reader.result; preview.style.display = ''; };
        reader.readAsDataURL(file);
      }

      function validarPasswords() {
        const p1 = form.elements['password'].value.trim();
        const p2 = form.elements['confirm'].value.trim();
        return p1.length >= 6 && p1 === p2;
      }

      function validarUnicidadMock() {
        // Parte 1: simulación de “en uso”. Solo ejemplo:
        const takenNick = ['admin', 'root', 'organizador1'];
        const takenMail = ['ya@existe.com'];
        const nick = form.elements['nickname'].value.trim().toLowerCase();
        const mail = form.elements['email'].value.trim().toLowerCase();
        if (takenNick.includes(nick)) return 'El nickname ya está en uso.';
        if (takenMail.includes(mail)) return 'El correo electrónico ya está en uso.';
        return '';
      }

      function validar() {
        msg.textContent = '';
        // validaciones HTML5
        if (!form.reportValidity()) return false;
        // contraseñas
        if (!validarPasswords()) { msg.textContent = 'Las contraseñas no coinciden o son muy cortas (mínimo 6).'; return false; }
        // unicidad (mock Parte 1)
        const err = validarUnicidadMock();
        if (err) { msg.textContent = err; return false; }
        return true;
      }

      // Eventos
      rolRadios.forEach(r => r.addEventListener('change', toggleRol));
      chkInst && chkInst.addEventListener('change', toggleInstitucion);
      inputImg && inputImg.addEventListener('change', e => showPreview(e.target.files?.[0]));
      form.addEventListener('submit', e => {
        e.preventDefault();
        if (!validar()) return;
        msg.style.color = '#2a7f2e';
        msg.textContent = '✅ Usuario creado (simulado - Parte 1). Redirigiendo…';
        setTimeout(() => { window.location.href = 'index.html'; }, 1200);
      });

      // init
      toggleRol();
      toggleInstitucion();
    })();
  </script>
</body>

</html>