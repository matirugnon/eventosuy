<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Perfil de Usuario · eventos.uy</title>
  <link rel="stylesheet" href="styles.css"/>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet"/>
</head>
<body>
  <div>
    <header class="header">
      <h1>eventos.uy</h1>
      <nav>
        <ul class="nav-links">
          <li><a href="index.html">Inicio</a></li>
          <li><a href="usuarios.html">Usuarios</a></li>
          <li><a href="#">Categorias</a></li>
        </ul>
      </nav>
      <div>
        <a href="iniciodesesion.html" class="btn-primary">Iniciar sesión</a>
        <a href="altadeusuario.html" class="btn-primary">Registrarse</a>
        <a href="listarUsuarios.html" class="btn-primary">Usuario</a>
      </div>
    </header>

    <div class="content single">
      <main>
        <section class="auth-container">
          <div class="auth-card">
            <h2>Perfil de Usuario</h2>

            <div id="perfilHeader" style="display:flex; gap:1rem; align-items:center; margin-bottom:1rem;">
              <!-- avatar + datos -->
            </div>

            <div id="bloqueOrganizador" style="display:none;">
              <h3 style="margin-top:1rem; color:#182080;">Ediciones del organizador</h3>
              <ul id="listaEdiciones" style="margin-top:.5rem;"></ul>
              <small style="color:#555; display:block; margin-top:.25rem;">
                (En Parte 1 se muestran solo ediciones en estado Aceptada)
              </small>
            </div>

            <div id="bloqueAsistente" style="display:none;">
              <h3 style="margin-top:1rem; color:#182080;">Registros del asistente</h3>
              <ul id="listaRegistros" style="margin-top:.5rem;"></ul>
            </div>
          </div>
        </section>
      </main>
    </div>
  </div>

  <footer></footer>

  <script>
    // Tomamos el usuario seleccionado desde la URL
    const qs = new URLSearchParams(location.search);
    const nick = qs.get('nick');

    // Leemos users hardcodeados desde usuarios.html
    const USERS = JSON.parse(localStorage.getItem('USERS_MOCK') || '[]');
    const selected = USERS.find(u => u.nick === nick);

    const perfilHeader = document.getElementById('perfilHeader');
    const bloqueOrg = document.getElementById('bloqueOrganizador');
    const bloqueAs  = document.getElementById('bloqueAsistente');
    const listaEd   = document.getElementById('listaEdiciones');
    const listaReg  = document.getElementById('listaRegistros');

    if (!selected) {
      perfilHeader.innerHTML = '<p>No se encontró el usuario seleccionado.</p>';
    } else {
      // Datos básicos + imagen
      perfilHeader.innerHTML = `
        <img src="${selected.avatar || 'img/user.png'}" alt="Avatar"
             style="width:100px;height:100px;border-radius:50%;object-fit:cover;">
        <div>
          <p><strong>Nickname:</strong> ${selected.nick}</p>
          <p><strong>Nombre:</strong> ${selected.nombre}</p>
          <p><strong>Correo:</strong> ${selected.email}</p>
          ${selected.rol === 'organizador'
            ? `
              <p><strong>Rol:</strong> Organizador</p>
              <p><strong>Descripción:</strong> ${selected.descripcion || '-'}</p>
              <p><strong>Sitio web:</strong> ${selected.web ? `<a href="${selected.web}" target="_blank">${selected.web}</a>` : '-'}</p>
            `
            : `
              <p><strong>Rol:</strong> Asistente</p>
              <p><strong>Apellido:</strong> ${selected.apellido || '-'}</p>
              <p><strong>Fecha de nacimiento:</strong> ${selected.nacimiento || '-'}</p>
              <p><strong>Institución:</strong> ${selected.institucion || '-'}</p>
            `
          }
        </div>
      `;

      // Mostrar según rol (siempre “como tercero”)
      if (selected.rol === 'organizador') {
        bloqueOrg.style.display = '';

        // SOLO ediciones aceptadas (como si NO fuera su propio perfil)
        const aceptadas = (selected.ediciones || []).filter(e => e.estado === 'Aceptada');

        listaEd.innerHTML = aceptadas.length
          ? aceptadas.map(e => `<li><a href="consultaedicion.html">${e.nombre}</a> <em>(${e.estado})</em></li>`).join('')
          : `<li>No hay ediciones aceptadas para mostrar.</li>`;
      } else {
        bloqueAs.style.display = '';

        const regs = selected.registros || [];
        listaReg.innerHTML = regs.length
          ? regs.map(r => `
              <li>
                <a href="consultaregistro.html">${r.edicion}</a>
                — ${r.tipo} — ${r.patrocinio ? 'con patrocinio' : 'general'} — ${r.costo === 0 ? 'gratis' : '$ ' + r.costo} — ${r.fecha}
              </li>
            `).join('')
          : `<li>No hay registros para mostrar.</li>`;
      }
    }
  </script>
</body>
</html>
